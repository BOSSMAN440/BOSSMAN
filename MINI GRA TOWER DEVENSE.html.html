<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Mini Hill Climb Racing Advanced</title>
<style>
body {background:#222;color:white;font-family:Arial;text-align:center;}
canvas {background:#87CEEB;display:block;margin:auto;border:2px solid #555;}
#ui {margin-top:10px;}
button {padding:10px;margin:5px;cursor:pointer;}
</style>
</head>
<body>

<h1>ðŸš— Mini Hill Climb Racing Advanced</h1>
<p>OdlegÅ‚oÅ›Ä‡: <span id="distance">0</span> m | Silnik: <span id="engine">1</span> | Zawieszenie: <span id="suspension">1</span> | Nitro: <span id="nitro">0</span></p>
<div id="ui">
  <button onclick="upgrade('engine')">Ulepsz silnik (50 pkt)</button>
  <button onclick="upgrade('suspension')">Ulepsz zawieszenie (50 pkt)</button>
  <button onclick="useNitro()">UÅ¼yj Nitro (100 pkt)</button>
</div>

<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// --- STAN GRY ---
let terrain = [];
let terrainWidth = 30000;
let scrollX = 0;
let distance = 0;
let points = 0;
let obstacles = [];

let car = {
  x: 100,
  y: 0,
  vx: 0,
  vy: 0,
  width: 50,
  height: 20,
  angle: 0,
  onGround: false,
  engine: 1,
  suspension: 1,
  nitro: 0
};

let keys = {};

// --- GENEROWANIE TERENU I PRZESZKÃ“D ---
function generateTerrain(){
  let lastY = canvas.height/2 + 50;
  for(let x=0;x<terrainWidth;x+=10){
    // losowa wysokoÅ›Ä‡
    lastY += Math.random()*20-10;
    lastY = Math.min(canvas.height-50, Math.max(150,lastY));
    
    // losowy typ terenu
    let typeRand = Math.random();
    let type = "grass";
    if(typeRand>0.85) type="stone";
    else if(typeRand>0.7) type="sand";
    
    terrain.push({x,lastY,type});
    
    // przeszkody
    if(Math.random()<0.02){
      obstacles.push({x,lastY-20,type:Math.random()<0.5?"hole":"barrel"});
    }
  }
}
generateTerrain();

// --- FIZYKA ---
const gravity = 0.5;

function updatePhysics(){
  // przyspieszenie
  if(keys.ArrowRight) car.vx += 0.2*car.engine;
  if(keys.ArrowLeft) car.vx -= 0.1;

  // obrÃ³t w powietrzu
  if(!car.onGround){
    if(keys.ArrowUp) car.angle -= 0.05;
    if(keys.ArrowDown) car.angle += 0.05;
  }

  // Nitro
  if(car.nitro>0){
    car.vx += 0.5;
    car.nitro -= 0.5;
  }

  car.vy += gravity;

  // kolizja z terenem
  let terrainY = getTerrainY(car.x);
  if(car.y+car.height/2 >= terrainY){
    car.y = terrainY - car.height/2;
    car.vy = -car.vy*0.3; 
    car.onGround = true;
    car.angle *= 0.9;
  } else {
    car.onGround = false;
  }

  // kolizje z przeszkodami
  for(let obs of obstacles){
    if(Math.abs(car.x - obs.x)<25 && Math.abs(car.y - obs.y)<20){
      if(obs.type==="hole") car.vy -= 5;
      if(obs.type==="barrel") car.vx *= 0.7;
    }
  }

  car.x += car.vx;
  car.y += car.vy;

  scrollX = car.x - 100;

  distance = Math.floor(car.x/10);
  points = distance;
}

// --- POMOCNICZE ---
function getTerrainY(x){
  const i = Math.floor(x/10);
  if(i>=terrain.length-1) return canvas.height/2+50;
  const t0 = terrain[i];
  const t1 = terrain[i+1];
  const ratio = (x-t0.x)/(t1.x-t0.x);
  return t0.y*(1-ratio)+t1.y*ratio;
}

// --- RYSOWANIE ---
function drawTerrain(){
  ctx.beginPath();
  ctx.moveTo(terrain[0].x - scrollX, terrain[0].y);
  for(let i=1;i<terrain.length;i++){
    const color = terrain[i].type==="grass"?"#228B22": terrain[i].type==="stone"?"#888":"#DAA520";
    ctx.strokeStyle = color;
    ctx.lineWidth = 10;
    ctx.lineTo(terrain[i].x - scrollX, terrain[i].y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(terrain[i].x - scrollX, terrain[i].y);
  }
}

function drawObstacles(){
  for(let obs of obstacles){
    const x = obs.x - scrollX;
    const y = obs.y;
    if(obs.type==="hole"){
      ctx.fillStyle="black";
      ctx.beginPath();
      ctx.arc(x,y,10,0,Math.PI*2);
      ctx.fill();
    } else {
      ctx.fillStyle="brown";
      ctx.fillRect(x-10,y-20,20,20);
    }
  }
}

function drawCar(){
  ctx.save();
  ctx.translate(car.x - scrollX, car.y);
  ctx.rotate(car.angle);
  // Auto
  ctx.fillStyle="red";
  ctx.fillRect(-car.width/2, -car.height/2, car.width, car.height);
  // KoÅ‚a
  ctx.fillStyle="black";
  ctx.beginPath();
  ctx.arc(-car.width/3, car.height/2, 8, 0, Math.PI*2);
  ctx.arc(car.width/3, car.height/2, 8, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();
}

// --- ULEPSZENIA ---
function upgrade(type){
  if(points<50) return alert("Za maÅ‚o punktÃ³w!");
  if(type==='engine') car.engine += 0.5;
  if(type==='suspension') car.suspension += 0.5;
  points -= 50;
  document.getElementById("engine").innerText = car.engine;
  document.getElementById("suspension").innerText = car.suspension;
}

function useNitro(){
  if(points<100) return alert("Za maÅ‚o punktÃ³w!");
  car.nitro = 50;
  points -= 100;
  document.getElementById("nitro").innerText = car.nitro.toFixed(0);
}

// --- STEROWANIE ---
document.addEventListener('keydown', e=>keys[e.key]=true);
document.addEventListener('keyup', e=>keys[e.key]=false);

// --- PÄ˜TLA GRY ---
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  updatePhysics();
  drawTerrain();
  drawObstacles();
  drawCar();
  document.getElementById("distance").innerText = distance;
  document.getElementById("nitro").innerText = car.nitro.toFixed(0);
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
