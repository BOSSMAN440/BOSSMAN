<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Tower Defense</title>
<style>
  body {
    background: #222;
    color: white;
    font-family: Arial;
    text-align: center;
  }
  canvas {
    background: #333;
    display: block;
    margin: 10px auto;
    border: 2px solid #555;
  }
</style>
</head>
<body>

<h1>üèπ Tower Defense</h1>
<p>Z≈Çoto: <span id="gold">100</span> | ≈ªycia: <span id="lives">10</span></p>

<canvas id="game" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gold = 100;
let lives = 10;
let enemies = [];
let towers = [];
let bullets = [];

const path = [
  {x: 0, y: 200},
  {x: 600, y: 200}
];

class Enemy {
  constructor() {
    this.x = 0;
    this.y = 200;
    this.hp = 100;
    this.speed = 1;
  }
  move() {
    this.x += this.speed;
    if (this.x > 600) {
      lives--;
      updateUI();
      enemies.splice(enemies.indexOf(this), 1);
    }
  }
  draw() {
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 10, 0, Math.PI * 2);
    ctx.fill();

    // HP bar
    ctx.fillStyle = "green";
    ctx.fillRect(this.x - 10, this.y - 15, (this.hp / 100) * 20, 4);
  }
}

class Tower {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.range = 100;
    this.cooldown = 0;
  }
  shoot() {
    if (this.cooldown > 0) {
      this.cooldown--;
      return;
    }
    for (let e of enemies) {
      const dist = Math.hypot(e.x - this.x, e.y - this.y);
      if (dist < this.range) {
        bullets.push(new Bullet(this.x, this.y, e));
        this.cooldown = 30;
        break;
      }
    }
  }
  draw() {
    ctx.fillStyle = "blue";
    ctx.fillRect(this.x - 10, this.y - 10, 20, 20);
  }
}

class Bullet {
  constructor(x, y, target) {
    this.x = x;
    this.y = y;
    this.target = target;
    this.speed = 4;
  }
  move() {
    if (!this.target) return;
    const dx = this.target.x - this.x;
    const dy = this.target.y - this.y;
    const dist = Math.hypot(dx, dy);

    this.x += (dx / dist) * this.speed;
    this.y += (dy / dist) * this.speed;

    if (dist < 5) {
      this.target.hp -= 20;
      if (this.target.hp <= 0) {
        gold += 10;
        enemies.splice(enemies.indexOf(this.target), 1);
        updateUI();
      }
      bullets.splice(bullets.indexOf(this), 1);
    }
  }
  draw() {
    ctx.fillStyle = "yellow";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
    ctx.fill();
  }
}

function updateUI() {
  document.getElementById("gold").innerText = gold;
  document.getElementById("lives").innerText = lives;
}

canvas.addEventListener("click", e => {
  if (gold < 50) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  // nie pozw√≥l stawiaƒá na drodze
  if (Math.abs(y - 200) < 30) return;

  towers.push(new Tower(x, y));
  gold -= 50;
  updateUI();
});

function spawnEnemy() {
  enemies.push(new Enemy());
}

setInterval(spawnEnemy, 2000);

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // droga
  ctx.strokeStyle = "#777";
  ctx.lineWidth = 40;
  ctx.beginPath();
  ctx.moveTo(0, 200);
  ctx.lineTo(600, 200);
  ctx.stroke();

  for (let e of enemies) {
    e.move();
    e.draw();
  }

  for (let t of towers) {
    t.shoot();
    t.draw();
  }

  for (let b of bullets) {
    b.move();
    b.draw();
  }

  if (lives <= 0) {
    alert("GAME OVER");
    location.reload();
  }

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
